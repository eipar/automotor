/*
===============================================================================
 PROBLEMA 2.1
 Hacer parpadear un LED en P0.22, con demora por SysTick, utilizando CMSIS.
 Versi√≥n: 0.0
 Curso: R4054
 Fecha: 06/06/12
 Ing. Ruben M. Lozano
 ===============================================================================
*/

//#include <lpc17xx_gpio.h>
#include "LPC17xx.h"

#include <cr_section_macros.h>
#include <NXP/crp.h>


// Variable to store CRP value in. Will be placed automatically
// by the linker when "Enable Code Read Protect" selected.
// See crp.h header for more information
__CRP const unsigned int CRP_WORD = CRP_NO_CRP ;


volatile uint32_t msTicks; // counter for 1ms SysTicks

// ****************
//  SysTick_Handler - just increment SysTick counter
void SysTick_Handler(void) {
  msTicks++;
}

// ****************
// systick_delay - creates a delay of the appropriate number of Systicks (happens every 1 ms)
__INLINE static void systick_delay (uint32_t delayTicks) {
  uint32_t currentTicks;

  currentTicks = msTicks;	// read current tick counter
  // Now loop until required number of ticks passes.
  while ((msTicks - currentTicks) < delayTicks);
}


int main(void)
{

	GPIO_SetDir(0, 22 , 1);	//Configuro el pin como salida
	if (SysTick_Config(SystemCoreClock / 1000)) {
		    while (1);  // Capture error
		}


	while(1)
		{
		GPIO_SetValue(0, 22);        //coloco un "1" en P0.22
		systick_delay (2000); // wait 2 seconds (2000ms)

		GPIO_ClearValue(0, 22);        //coloco un "0" en P0.22
		systick_delay (2000); // wait 2 seconds (2000ms)
		}

	return 0 ;
}

